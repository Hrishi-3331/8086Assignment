ASSUME CS:CODE, DS:DATA

DATA SEGMENT
    PORTA EQU 00F8H
    PORTB EQU 00FAH
    PORTC EQU 00FCH
    PORT_CWR EQU 00FEH
    CNTR0 EQU 0078H
    CNTR1 EQU 007AH
    CNTR2 EQU 007CH
    CNTR_CWR EQU 007EH
DATA ENDS

CODE SEGMENT
START:
MOV AX, DATA
MOV DS,AX

;Initialize 8255 all ports as input port
MOV DX, PORT_CWR
MOV AL, 9AH
OUT DX, AL

BACK:
MOV DX, PORTC
MOV AL, 0FFH
OUT DX, AL

CHECK:
IN AL, DX
TEST AL, 80H
JZ CHECK

MOV AL, 00H
OUT DX, AL

;Read the count value and store in CX register
MOV DX, PORTB
IN AL, DX
MOV CL, AL
MOV DX, PORTA
IN AL, DX
MOV CH, AL

;Initialize counter 0
MOV DX, CNTR_CWR
MOV AL, 31H
OUT DX, AL

;Load LSB
MOV DX, CNTR0
MOV AL, CL
OUT DX, AL

;Load MSB
MOV AL, CH
OUT DX, AL

;Initialize counter 1
MOV DX, CNTR_CWR
MOV AL, 51H
OUT DX, AL
MOV AL, 4D
MOV DX, CNTR1
OUT DX, AL

MOV DX, PORTC
L1:
IN AL, DX
TEST AL, 40H
JZ  L1
L2:
IN AL, DX
TEST AL, 40H
JNZ L2
JMP BACK

CODE ENDS
END START
END
